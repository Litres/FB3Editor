Constructor=function(){for(var a in this){if(isArray(this[a])){this[a]=this[a].clone()}if(isObject(this[a])){this[a]=clone({},this[a])}this[a]=this[a]}};if(typeof(JSON)!="undefined"){if(typeof(JSON.parse)!="undefined"){JSON.decode=JSON.parse}if(typeof(JSON.stringify)!="undefined"){JSON.encode=JSON.stringify}}ERROR=new function(){var g=this,e=[],i=(typeof(Ext)!="undefined"?Ext:{}),b="",h=(typeof(h)!="undefined"?h:{ds:{getValue:function(){},setValue:function(){}},show:function(){alert("Окна ошибок нет")}}),f=(typeof(f)!="undefined"?f:{encode:function(j){return j}}),a=(typeof(a)!="undefined"?a:{request:function(){}});this.reinit=function(j){j=(j||{});i=(j.fw||Ext||i);b=(j.SITE_URL||b);h=(j.LOG||window.LOG||h);f=(j.JSON||(i.util?i.util.JSON:window.JSON)||f);a=(j.Ajax||i.Ajax||window.Ajax||a);h.ds.setValue(f.encode(e)+"\r\n")};function d(j){var k=j.userMsg||j.message||" Возникла непредвиденная ошибка ";if(DEBUG){k="file: "+j.file+"; line: "+j.line+"; function: "+j["function"]+"; msg: "+j.message+"; stack: "+j.stack}return k}var c=function(j){j=(j||new Error());j.code=(j.code||j.number||0);j.message=(j.message||"");j.userMsg=(j.userMsg||"");j.file=j.file||"";j.line=j.line||0;j["function"]=j["function"]||"";j.stack=(j.stack||"");return j};this.send=function(m){var k=0;function j(){window.setTimeout(l,3000)}function l(){if(k++>3){return}a.request({url:b,params:m,failure:j})}l()};this.add=function(j){e.push(new c(j));h.ds.setValue(h.ds.getValue()+"-------------\r\n"+f.encode(j)+"\r\n");if(typeof(DEBUG_LOG)!="undefined"&&DEBUG_LOG){g.send(j)}};this.getLastError=function(){var j=(e.length?(e.length-1):0);return(e[j]||new c())};this.getLastMessage=function(){return d(g.getLastError())};this.show=function(j){var k=d(new c(j));if(i&&i.Msg){i.Msg.show({title:"Внимание",msg:k,icon:i.Msg.ERROR,buttons:i.Msg.OK})}else{alert(k)}};window.onerror=function(){var j={message:arguments[0],file:arguments[1],line:arguments[2]};g.add(j)};return this};function isArray(a){return(Array.isArray?Array.isArray(a):Object.prototype.toString.apply(a)==="[object Array]")}function isObject(a){return !!a&&Object.prototype.toString.call(a)==="[object Object]"}function clone(f,c,a){for(var b in c){if(!c.hasOwnProperty(b)){continue}var e=isArray(c[b])?[]:isObject(c[b])?{}:undefined;if(e&&a!=0){if(isArray(f)){f.push(clone(e,c[b],a-1))}else{if(isObject(f)){f[b]=clone(e,c[b],a-1)}}}else{if(isArray(f)){f.push(c[b])}else{f[b]=c[b]}}}return f};
if(!String.prototype.format){String.prototype.format=function(format){var a=arguments;return this.replace(/\{(\d+)\}/g,function(m,i){return a[i];});}}